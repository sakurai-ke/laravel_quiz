import{k as i,h as E,m as J,A as K,H as de,o as _,f as v,a as O,u as w,w as G,F as x,p as C,b as t,i as H,x as P,t as r,g as M,c as _e,q as fe,s as q,d as y,n as pe,y as ve,z as ge}from"./app-865d1ee5.js";import{_ as me}from"./AuthenticatedLayout-1a72b56a.js";import{Z as ye}from"./index.esm-bde64fbc.js";import he from"./Chart-09d536ce.js";import{C as be}from"./auto-5842a5d9.js";import{_ as De}from"./_plugin-vue_export-helper-c27b6911.js";import{u as f}from"./index-210e5ca7.js";import"./ApplicationLogo-34c4e552.js";/* empty css                                              */const p=k=>(ve("data-v-99b827c6"),k=k(),ge(),k),we=p(()=>t("h2",{class:"font-semibold text-2xl text-gray-800 leading-tight"},"クイズの結果情報",-1)),xe={class:"bg-gray-100 py-8 px-4"},Ce={class:"max-w-3xl mx-auto"},ke={class:"flex space-x-4 mb-4"},Te={for:"fromDate",class:"flex items-center"},ze=p(()=>t("span",{class:"mr-1"},"From:",-1)),Re={for:"toDate",class:"flex items-center"},Ve=p(()=>t("span",{class:"mr-1"},"To:",-1)),qe={key:0,class:"text-red-500"},Ue=p(()=>t("option",{value:"all"},"全て",-1)),Ae=["value"],Se={class:"flex justify-between items-center"},Le={class:"text-lg font-semibold"},je={class:"text-gray-600"},Fe={class:"text-gray-600"},Ee={class:"text-gray-600"},He=["onClick"],Me={key:0,class:"mt-4 p-4 bg-gray-100 rounded-md"},Be={class:"border-b border-gray-300 pb-2 mb-2"},Ie=p(()=>t("h3",{class:"text-xl font-semibold mb-1"},"回答詳細",-1)),Ne={class:"text-gray-600"},Qe={class:"text-gray-600"},$e={class:"text-gray-600"},Je={class:"space-y-4"},Ke={class:"border border-gray-300 rounded-md p-4"},Oe={class:"text-lg font-semibold mb-2"},Ge=p(()=>t("strong",null,"選択した回答:",-1)),Pe=p(()=>t("strong",null,"結果:",-1)),Ze=p(()=>t("strong",null,"正解:",-1)),We=p(()=>t("strong",null,"誤答1:",-1)),Xe=p(()=>t("strong",null,"誤答2:",-1)),Ye=p(()=>t("strong",null,"誤答3:",-1)),et=p(()=>t("strong",null,"解説:",-1)),tt={class:"mt-4 flex justify-center space-x-1"},at=["disabled"],ot=["onClick"],st=["disabled"],nt={__name:"Recordddd",setup(k){const m=i(1);let U=E(()=>Math.ceil(g.value.length/10));const g=i([]),D=i(null),c=i(null),u=i(null),h=i([]),A=i(null),T=i(null),B=i([]),b=i("all"),S=a=>{a>=1&&a<=U.value&&(m.value=a)},Z=E(()=>{const a=(m.value-1)*10,o=a+10;return g.value.slice(a,o)});function W(a,o){const e=[];e.push(1),o>3&&e.push("...");for(let s=o-2;s<=o+2;s++)s>1&&s<a&&e.push(s);return o<a-2&&e.push("..."),e.push(a),e}async function X(){try{const a=await C.get("/api/quiz-results");g.value=a.data.sort((o,e)=>new Date(e.created_at)-new Date(o.created_at)),g.value.forEach(o=>{o.created_at=f(new Date(o.created_at),"Asia/Tokyo")})}catch(a){console.error("クイズの結果情報の取得に失敗しました",a)}}function Y(a){D.value===a?D.value=null:D.value=a}const ee={dateValidation:"Fromの日付はTo以前の日付を選択してください"};let z=i(""),te=[];async function ae(){try{let e=(await C.get("/api/quiz-results")).data.sort((l,V)=>new Date(V.created_at)-new Date(l.created_at));if(c.value&&u.value&&new Date(c.value)>new Date(u.value)){z.value=ee.dateValidation;return}else z.value="";console.log("quizRecords.value",g.value);const s=c.value?f(new Date(c.value),"UTC"):null,d=u.value?f(new Date(u.value),"UTC"):null;d&&d.setHours(d.getHours()+24),console.log("fromDateTime",s),console.log("toDateTime",d),e=e.filter(l=>{const V=f(new Date(l.created_at),"Asia/Tokyo");return(!s||V>=s)&&(!d||V<=d)}),console.log("filteredResult2",e),e.forEach(l=>{l.created_at=f(new Date(l.created_at),"Asia/Tokyo")}),te=e,await N();const n=I(e);g.value=n,re(),j(R(n))}catch(a){console.error("クイズの結果情報の取得に失敗しました",a)}}function I(a){if(!c.value&&!u.value)return a;const o=c.value?f(new Date(c.value),"UTC"):null,e=u.value?f(new Date(u.value),"UTC"):null;return e&&e.setHours(e.getHours()+24),console.log("fromDateValue3",o),console.log("toDateValue3",e),a.filter(s=>{const d=f(new Date(s.created_at),"Asia/Tokyo");return(!o||d>=o)&&(!e||d<=e)})}const L=i({});async function oe(){try{(await C.get("/api/categories")).data.forEach(e=>{L.value[e.id]=e.name})}catch(a){console.error("カテゴリー情報の取得に失敗しました",a)}}async function N(){try{let o=(await C.get("/api/quiz-results")).data;if(c.value){const n=f(new Date(c.value),"UTC");o=o.filter(l=>new Date(l.created_at)>=n),console.log("fromDateTime2",n)}if(u.value){const n=f(new Date(u.value),"UTC");n.setDate(n.getDate()+1),o=o.filter(l=>new Date(l.created_at)<n),console.log("toDateTime2",n)}const e={},s={};o.forEach(n=>{const l=n.category_id;e[l]||(e[l]=0),s[l]||(s[l]=0),e[l]+=n.correct_answers,s[l]+=n.total_questions}),h.value=Object.keys(e).map(n=>({name:Q(n),accuracy:ne(e[n],s[n])})),se(o.map(n=>n.category_id)).forEach(n=>{h.value.push({name:Q(n),accuracy:0})}),console.log("filteredResults: ",o)}catch(a){console.error("カテゴリー別の正答率データの取得に失敗しました",a)}}function se(a){return Object.keys(L.value).map(Number).filter(e=>!a.includes(e))}function Q(a){return L.value[a]||"Unknown Category"}function ne(a,o){return o===0?0:(a/o*100).toFixed(2)}J(()=>{X(),oe(),N()}),E(()=>I(g.value));function $(){return Math.random().toString(36).substring(7)}const le=i($());function re(){le.value=$()}const ce=i([]);function ue(){ce.value=R(h.value)}async function ie(){try{const a=await C.get("/api/categories");B.value=a.data}catch(a){console.error("カテゴリー情報の取得に失敗しました",a)}}i([]),K([h,c,u],ue),de(()=>{b.value="all"});function R(a){if(!c.value&&!u.value)return a;const o=c.value?f(new Date(c.value),"UTC"):null,e=u.value?f(new Date(u.value),"UTC"):null;e&&e.setHours(e.getHours()+24);const s=o?o.toLocaleString("ja-JP"):"",d=e?e.toLocaleString("ja-JP"):"";return console.log("fromDateValue4",s),console.log("toDateValue4",d),a.filter(n=>{const l=new Date(n.created_at).getTime();return l>=o&&l<=e})}function j(a){if(!A.value||(T.value&&(T.value.destroy(),T.value=null),Object.keys(a).length===0))return;const o=F(),e=[],s=[];for(const n in o){const l=o[n];e.push(l.accuracy),s.push(new Date(l.created_at).toLocaleDateString())}const d=A.value.getContext("2d");T.value=new be(d,{type:"line",data:{labels:s,datasets:[{label:"正答率",data:e,borderColor:"rgb(75, 192, 192)",tension:.1}]},options:{scales:{x:{title:{display:!0,text:"日付"},reverse:!0},y:{title:{display:!0,text:"正答率 (%)"}}}}})}function F(){return b.value==="all"?g.value:g.value.filter(a=>a.category_id===b.value)}return J(async()=>{await ie(),j(R(F()))}),K(b,()=>{j(R(F()))}),(a,o)=>(_(),v(x,null,[O(w(ye),{title:"クイズの結果情報"}),O(me,null,{header:G(()=>[we]),default:G(()=>[t("div",xe,[t("div",Ce,[t("div",ke,[t("label",Te,[ze,H(t("input",{type:"date",id:"fromDate","onUpdate:modelValue":o[0]||(o[0]=e=>c.value=e),class:"px-2 py-1 border rounded-md"},null,512),[[P,c.value]])]),t("label",Re,[Ve,H(t("input",{type:"date",id:"toDate","onUpdate:modelValue":o[1]||(o[1]=e=>u.value=e),class:"px-2 py-1 border rounded-md"},null,512),[[P,u.value]])]),t("button",{onClick:ae,class:"bg-blue-500 text-white px-3 py-1 rounded-md"}," 検索 ")]),w(z)?(_(),v("p",qe,r(w(z)),1)):M("",!0),h.value.length>0?(_(),_e(he,{key:1,categoryData:h.value},null,8,["categoryData"])):M("",!0),t("div",null,[H(t("select",{"onUpdate:modelValue":o[2]||(o[2]=e=>b.value=e)},[Ue,(_(!0),v(x,null,q(B.value,e=>(_(),v("option",{key:e.id,value:e.id},r(e.name),9,Ae))),128))],512),[[fe,b.value]]),t("canvas",{ref_key:"lineChartCanvas",ref:A},null,512)]),t("ul",null,[(_(!0),v(x,null,q(Z.value,e=>(_(),v("li",{key:e.id,class:"bg-white shadow-md p-4 mb-4 rounded-md"},[t("div",Se,[t("div",null,[t("h2",Le,r(new Date(e.created_at).toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),1),t("p",je,"カテゴリー: "+r(e.category.name),1),t("p",Fe,"出題数: "+r(e.total_questions),1),t("p",Ee,"正答率: "+r(e.accuracy)+"%",1)]),t("button",{class:"bg-blue-500 text-white px-3 py-1 rounded-md",onClick:s=>Y(e.id)},r(D.value===e.id?"閉じる":"回答詳細"),9,He)]),D.value===e.id?(_(),v("div",Me,[t("div",Be,[Ie,t("p",Ne,"問題数: "+r(e.total_questions),1),t("p",Qe,"正解数: "+r(e.correct_answers),1),t("p",$e,"正答率: "+r(e.accuracy)+"%",1)]),t("ul",Je,[(_(!0),v(x,null,q(e.results,s=>(_(),v("li",{key:s.id},[t("div",Ke,[t("h4",Oe,r(s.quiz.title),1),t("p",null,[Ge,y(" "+r(s.selected_choice),1)]),t("p",null,[Pe,y(" "+r(s.correct?"正解":"不正解"),1)]),t("p",null,[Ze,y(" "+r(s.quiz.correct_answer),1)]),t("p",null,[We,y(" "+r(s.quiz.wrong_answer_1),1)]),t("p",null,[Xe,y(" "+r(s.quiz.wrong_answer_2),1)]),t("p",null,[Ye,y(" "+r(s.quiz.wrong_answer_3),1)]),t("p",null,[et,y(" "+r(s.quiz.explain),1)])])]))),128))])])):M("",!0)]))),128))])])]),t("div",tt,[t("button",{onClick:o[3]||(o[3]=e=>S(m.value-1)),disabled:m.value===1,class:"px-3 py-1 rounded-md bg-white text-blue-500 border border-blue-500"}," 前へ ",8,at),(_(!0),v(x,null,q(W(w(U),m.value),e=>(_(),v("button",{key:e,onClick:s=>S(e),class:pe(["px-3 py-1 rounded-md",m.value===e?"bg-blue-500 text-white":"bg-white text-blue-500 border border-blue-500"])},r(e),11,ot))),128)),t("button",{onClick:o[4]||(o[4]=e=>S(m.value+1)),disabled:m.value===w(U),class:"px-3 py-1 rounded-md bg-white text-blue-500 border border-blue-500"}," 次へ ",8,st)])]),_:1})],64))}},vt=De(nt,[["__scopeId","data-v-99b827c6"]]);export{vt as default};
