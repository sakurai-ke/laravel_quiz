import{k as u,o as c,f as i,i as T,l as K,b as t,F as I,j as X,m as Y,p as B,a as Z,t as _,u as g,s as P,n as C,g as h,c as ee,w as te,B as se,C as oe,d as ae,y as le,z as ne}from"./app-54b52079.js";import{i as re}from"./index.esm-385d90a6.js";import{_ as ue}from"./_plugin-vue_export-helper-c27b6911.js";const ce={class:"fixed inset-0 flex items-center justify-center z-50","aria-hidden":"true"},ie=t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})],-1),de=[ie],be=X('<header class="modal__header flex justify-between items-center px-4 py-2 bg-gray-100 rounded-t-lg mt-4"><h2 class="modal__title text-lg font-semibold text-gray-800"><span class="font-bold text-blue-700">クイズ画面ヘルプ</span><br></h2></header><main class="modal__content p-4 text-gray-700"><p class="mb-4"><span class="font-bold text-blue-700">問題の表示:</span><br> 画面上部に問題文が表示されます。問題文をよく読み、正しい答えを選んでください。 </p><p class="mb-4"><span class="font-bold text-blue-700">選択肢の選択:</span><br> 問題文の下には選択肢が表示されます。正しい選択肢を選んでください。クイズには1つの正解があります。 </p><p class="mb-4"><span class="font-bold text-blue-700">ヒントボタン:</span><br> 「ヒント」ボタンをクリックすると、ChatGPTのAPIからヒントを取得します。このヒントは、問題文と正解の情報 からChatGPTによって生成されます。 </p><p class="mb-4"><span class="font-bold text-blue-700">回答ボタン:</span><br> 選択肢を選んだら、「回答」ボタンをクリックして回答を提出してください。正解か不正解かが表示されます。 </p><p class="mb-4"><span class="font-bold text-blue-700">クイズ番号のリスト:</span><br> 画面上側にはクイズ番号のリストが表示されます。クイズを飛び越えて選択することができます。 </p><p class="mb-4"><span class="font-bold text-blue-700">前のクイズへ / 次のクイズへ:</span><br> 「前のクイズへ」ボタンと「次のクイズへ」ボタンを使用して、前後の問題に移動できます。 </p><p class="mb-4"><span class="font-bold text-blue-700">結果を見る:</span><br> すべてのクイズに回答した後、結果（クイズの正解率）を確認するためのボタンが表示されます。 </p></main>',2),_e={__name:"QuizModal",setup(f){const b=u(!1),a=()=>{b.value=!b.value},k=d=>{d.target.classList.contains("modal__overlay")&&a()};return(d,o)=>(c(),i(I,null,[T(t("div",ce,[t("div",{class:"modal fixed inset-0 flex items-center justify-center z-50"},[t("div",{onClick:k,class:"modal__overlay fixed inset-0 bg-opacity-50 bg-black"}),t("div",{class:"modal__container bg-white rounded-lg shadow-lg max-w-md mx-auto p-4 z-50 relative",role:"dialog","aria-modal":"true","aria-labelledby":"modal-1-title"},[t("button",{onClick:a,type:"button",class:"modal__close absolute top-4 right-4 focus:outline-none text-gray-500 hover:text-gray-700"},de),be,t("footer",{class:"modal__footer px-4 py-2"},[t("button",{onClick:a,type:"button",class:"modal__btn modal__btn-primary bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded focus:outline-none mr-2"}," 閉じる ")])])])],512),[[K,b.value]]),t("button",{onClick:a,type:"button",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded focus:outline-none"},"ヘルプ")],64))}};const V=f=>(le("data-v-f1678a43"),f=f(),ne(),f),pe={class:"absolute top-40 right-4 z-50"},ge={class:"text-blue-500 font-semibold"},ve={class:"text-blue-500 font-semibold"},he={class:"text-blue-500 font-semibold"},fe={class:"w-full max-w-4xl mx-auto p-6 bg-white rounded-md shadow-md h-auto"},me=["src"],we={class:"quiz-progress flex justify-center items-center flex-wrap mb-4"},xe=["onClick"],ye={class:"mb-2 text-gray-600"},Ce={class:"text-xl font-semibold mb-4"},ke={class:"choice-list grid grid-cols-2 gap-4"},ze={class:"choice-label block"},Qe=["disabled","value"],Ne=["onClick"],De=["disabled"],qe={key:1,class:"quiz-end-message mt-4"},Be={key:0,class:"font-semibold text-green-500"},Ie={key:1},$e=V(()=>t("div",{class:"mb-4"},null,-1)),je={class:"button-group flex justify-between items-center mt-4"},Se={key:2,class:"mt-4 p-4 bg-gray-100 rounded-md"},Me=V(()=>t("h3",{class:"text-lg font-semibold mb-2"},"ヒント",-1)),Le={class:"text-gray-700"},Pe={__name:"Quiz",props:{quizData:Object,selectedNumQuestions:Number,selectedCategory:Number},setup(f){const b=f;console.log("selectedNumQuestionsの値:",b.selectedNumQuestions),console.log("record_idの値:",b.record_id),console.log("selectedCategoryの値:",b.selectedCategory);const a=u(null),k=u([]),d=u("");let o=0,s=[];const p=u(b.quizData),A=u(b.selectedCategory);u(b.selectedNumQuestions);const m=u(!0),$=[],z=u(0);u(null);const Q=u(0),w=u(!0),x=u(!1),S=u(!1);Y(()=>{M()}),s.forEach(e=>{e.user_answer="",e.answered=!1});function R(e){for(let n=e.length-1;n>0;n--){const r=Math.floor(Math.random()*(n+1));[e[n],e[r]]=[e[r],e[n]]}return console.log("choices",e),e}function N(){const e=s[o];console.log("newQuizData",e),p.value=e,k.value=e.choices,a.value=e.user_choice,v.value=null}async function M(){try{const n=(await B.get("/api/quizzes",{params:{category_id:p.value.category_id,num_questions:b.selectedNumQuestions}})).data;if(n.length>0){const r=s.map(l=>l.id);s=n.filter(l=>!r.includes(l.id)).map(l=>({...l,isCorrect:a.value===l.correct_answer,user_choice:"",choices:R([l.correct_answer,l.wrong_answer_1,l.wrong_answer_2,l.wrong_answer_3])})),console.log("shuffledQuizList",s),s[o].answered&&(a.value=s[o].user_answer),N(),m.value=!0,d.value="",D()}else console.error("次のクイズデータがありません")}catch(e){console.error("クイズの取得に失敗しました",e)}}const E=u(!0);async function O(){const e=s[o];if(a.value===e.correct_answer?(d.value=`正解！
${e.explain}`,e.user_answer=a.value,e.answered=!0,$.push(e),z.value=$.length/s.length*100):(d.value=`不正解！正解は「${e.correct_answer}」です。
${e.explain}`,e.user_answer=a.value,e.answered=!0),await se(),m.value=!1,Q.value++,Q.value===s.length)try{if(E.value){const r={category_id:A.value,total_questions:s.length,correct_answers:$.length,accuracy:z.value,created_at:new Date,updated_at:new Date},y=(await B.post("/api/record",r)).data.data.id;for(const q of s){const J={record_id:y,quiz_id:q.id,selected_choice:q.user_answer,correct:q.user_answer===q.correct_answer,created_at:new Date,updated_at:new Date};await B.post("/api/result",J)}}Q.value===s.length&&(S.value=!0)}catch(r){console.error("結果の保存に失敗しました",r)}}async function L(){d.value="",a.value="",o<s.length-1?(o++,N(),s[o].answered?m.value=!1:m.value=!0,D()):M()}function F(){d.value="",a.value="",o>0&&(o--,N(),D())}function D(){o===0?(x.value=!1,w.value=!0):o===s.length-1?(x.value=!0,w.value=!1):(x.value=!0,w.value=!0)}function G(e){s[o].answered||(a.value=e,j.value=e,s[o].user_choice=e)}function U(e){return"{{ asset('storage/images') }}/"+e}const j=u(null);function W(e){o=e,s[o].answered?j.value=s[o].user_choice:j.value=null,N(),m.value=!0,D()}const v=u("");async function H(){v.value=null;try{const e=await B.post("/api/get-hint",{problem_statement:p.value.title,correct_answer:p.value.correct_answer});console.log("responseの値:",e);const n=e.data.hint;n?(v.value=n,console.log("ヒントの値:",v.value)):v.value="このクイズにはヒントがありません。"}catch(e){console.error("ヒントの取得に失敗しました",e)}}return(e,n)=>(c(),i(I,null,[t("div",pe,[Z(_e)]),t("p",ge,"正答率"+_(z.value),1),t("p",ve,"何問目か"+_(g(o)+1),1),t("p",he,"回答済みはいくつあるか"+_(Q.value),1),t("div",fe,[t("img",{src:U(p.value.image_src),alt:"Quiz Image",class:"mb-4"},null,8,me),t("div",we,[(c(!0),i(I,null,P(g(s),(r,l)=>(c(),i("div",{key:l,class:C(["quiz-number",r.answered?"bg-green-500 text-white":"bg-white border",l===g(o)?"current-quiz":""]),onClick:y=>W(l)},_(l+1),11,xe))),128))]),t("p",ye,_(g(o)+1)+"問目 / "+_(g(s).length)+"問中 ",1),t("h2",Ce,_(p.value.title),1),t("ul",ke,[(c(!0),i(I,null,P(k.value,(r,l)=>(c(),i("li",{key:l},[t("label",ze,[T(t("input",{type:"radio",disabled:p.value.answered,"onUpdate:modelValue":n[0]||(n[0]=y=>a.value=y),value:r,class:"hidden"},null,8,Qe),[[oe,a.value]]),t("button",{class:C(["choice-button w-full py-2 px-4 rounded-md focus:outline-none transition duration-300",a.value===r?"bg-blue-500 text-white":"bg-gray-300 cursor-not-allowed"]),onClick:y=>G(r)},_(r),11,Ne)])]))),128))]),m.value&&!p.value.answered?(c(),i("button",{key:0,onClick:O,class:C(["answer-button mt-4 w-full py-2 px-4 rounded-md focus:outline-none transition duration-300",a.value!==""?"bg-blue-500 hover:bg-blue-600 text-white":"bg-gray-300 cursor-not-allowed"]),disabled:a.value===""}," 回答 ",10,De)):h("",!0),d.value!==""?(c(),i("div",qe,[d.value.startsWith("正解")?(c(),i("p",Be,_(d.value),1)):(c(),i("p",Ie,_(d.value),1)),$e,g(o)<g(s).length-1?(c(),i("button",{key:2,onClick:L,"on:quizCompleted":n[1]||(n[1]=(...r)=>e.quizCompleted&&e.quizCompleted(...r)),class:"w-1/2 mx-auto py-2 px-4 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none transition duration-300"}," 次へ ",32)):h("",!0),S.value?(c(),ee(g(re),{key:3,href:e.route("quiz.result",{correctPercentage:z.value}),class:"mt-4 w-full py-2 px-4 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none transition duration-300"},{default:te(()=>[ae(" 結果を見る ")]),_:1},8,["href"])):h("",!0)])):h("",!0),t("div",je,[x.value?(c(),i("button",{key:0,onClick:F,class:C(["prev-button",x.value?"bg-blue-500 hover:bg-blue-600 text-white":"bg-gray-300 cursor-not-allowed"])}," 前のクイズへ ",2)):h("",!0),w.value?(c(),i("button",{key:1,onClick:L,class:C(["next-button",w.value?"bg-blue-500 hover:bg-blue-600 text-white":"bg-gray-300 cursor-not-allowed"])}," 次のクイズへ ",2)):h("",!0)]),t("button",{onClick:H,class:"mt-4 py-2 px-4 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none transition duration-300"}," ヒント "),v.value?(c(),i("div",Se,[Me,t("p",Le,_(v.value),1)])):h("",!0)])],64))}},Re=ue(Pe,[["__scopeId","data-v-f1678a43"]]);export{Re as default};
