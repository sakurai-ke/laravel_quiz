import{k as u,o as p,f as _,i as h,l as L,b as e,F as k,j as V,m as F,p as w,a as y,u as D,w as C,x as S,t as M,g as P,q as R,s as B}from"./app-219f245d.js";import{_ as H}from"./AuthenticatedLayout-d5afd5c8.js";import{Z as N}from"./index.esm-6aa3b88f.js";import{C as E}from"./auto-5842a5d9.js";import"./ApplicationLogo-e8a5445c.js";import"./_plugin-vue_export-helper-c27b6911.js";const A={class:"fixed inset-0 flex items-center justify-center z-50","aria-hidden":"true"},W=e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})],-1),Z=[W],q=V('<header class="modal__header flex justify-between items-center px-4 py-2 bg-gray-100 rounded-t-lg mt-4"><h2 class="modal__title text-lg font-semibold text-gray-800"><span class="font-bold text-blue-700">ランキング画面ヘルプ</span><br></h2></header><main class="modal__content p-4 text-gray-700"><p class="mb-4"><span class="font-bold text-blue-700">ランキングデータの表示:</span><br> 選択した期間およびカテゴリーに基づいてユーザーのランキングデータが表示されます。 ユーザー名と正答率のバーグラフがランク順に表示され、各ユーザーのクイズ成績が一覧できます。 </p><p class="mb-4"><span class="font-bold text-blue-700">期間の指定:</span><br> ランキング画面では、特定の期間内のユーザーランキングを表示できます。 画面上部の「From」および「To」欄に開始日と終了日を入力し、検索ボタンをクリックすることで指定期間のランキングを表示します。 期間を指定せずに検索すると、全期間のランキングが表示されます。 </p><p class="mb-4"><span class="font-bold text-blue-700">カテゴリーの選択:</span><br> 表示するランキングのカテゴリーを選択できます。画面下部の「カテゴリー」ボックスからカテゴリーを選択し、検索ボタンをクリックすることで指定したカテゴリーのランキングが表示されます。 全てのカテゴリーを表示する場合は「全て」を選択してください。 </p></main>',2),G={__name:"RankModal",setup(T){const c=u(!1),r=()=>{c.value=!c.value},f=n=>{n.target.classList.contains("modal__overlay")&&r()};return(n,i)=>(p(),_(k,null,[h(e("div",A,[e("div",{class:"modal fixed inset-0 flex items-center justify-center z-50"},[e("div",{onClick:f,class:"modal__overlay fixed inset-0 bg-opacity-50 bg-black"}),e("div",{class:"modal__container bg-white rounded-lg shadow-lg max-w-md mx-auto p-4 z-50 relative",role:"dialog","aria-modal":"true","aria-labelledby":"modal-1-title"},[e("button",{onClick:r,type:"button",class:"modal__close absolute top-4 right-4 focus:outline-none text-gray-500 hover:text-gray-700"},Z),q,e("footer",{class:"modal__footer px-4 py-2"},[e("button",{onClick:r,type:"button",class:"modal__btn modal__btn-primary bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded focus:outline-none mr-2"}," 閉じる ")])])])],512),[[L,c.value]]),e("button",{onClick:r,type:"button",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded focus:outline-none"},"ヘルプ")],64))}};const J=e("h2",{class:"font-semibold text-2xl text-gray-800 leading-tight"},"ランキング",-1),K={class:"absolute top-40 right-4 z-50"},Q={class:"p-6 mt-10"},X={class:"space-y-2"},Y={class:"flex space-x-2 items-center"},ee=e("label",{for:"fromDate",class:"text-gray-600"},"From:",-1),te=e("label",{for:"toDate",class:"text-gray-600"},"To:",-1),ae={key:0,class:"text-red-500"},oe={class:"flex space-x-2 items-center"},se=e("label",{for:"categorySelect",class:"text-gray-600"},"カテゴリー:",-1),ne=e("option",{value:"all"},"全て",-1),le=["value"],re={class:"mt-6",style:{"max-width":"1500px","max-height":"1200px"}},pe={__name:"Rank",setup(T){const c=u(null),r=u("all"),f=u([]),n=u(null),i=u(null);window.addEventListener("resize",()=>{l&&O()});function O(){c.value.getContext("2d"),l.resize();const s=l.data.labels.length,t=Math.max(10,Math.max(...l.data.datasets[0].data)),a=Math.max(0,t-(10-s));l.options.scales.y.ticks.suggestedMax=t,l.options.scales.y.ticks.suggestedMin=a,l.update()}let b=u("");F(()=>{$(),v()});async function $(){try{const s=await w.get("/api/categories");f.value=s.data}catch(s){console.error("カテゴリー情報の取得に失敗しました",s)}}function I(){if(b.value="",n.value&&i.value){const s=new Date(n.value),t=new Date(i.value);if(s>t)return b.value="Fromの日付はTo以前の日付を選択してください。",!1}return!0}async function v(){if(I())try{const s=r.value==="all"?"":`&category=${r.value}`;let t="";if(n.value&&i.value){const o=new Date(n.value),d=new Date(i.value);o.setUTCHours(0,0,0,0),d.setUTCHours(0,0,0,0),console.log("fromDateTime: ",o),console.log("toDateTime: ",d);const j=o.toISOString(),U=d.toISOString();t=`fromDate=${j}&toDate=${U}`,console.log("dateParamsfromto: ",t)}else if(n.value){const o=new Date(n.value);o.setUTCHours(0,0,0,0),t=`fromDate=${o.toISOString()}`,console.log("dateParamsfrom: ",t)}else if(i.value){const o=new Date(i.value);o.setUTCHours(0,0,0,0),t=`toDate=${o.toISOString()}`,console.log("dateParamsto: ",t)}const a=await w.get(`/api/ranking?${t}${s}`),m=a.data;m.sort((o,d)=>d.accuracy-o.accuracy);const g=m.map(o=>o.user.name),x=m.map(o=>o.accuracy);console.log("response: ",a),console.log("rankingData: ",m),console.log("labels: ",g),console.log("dataValues: ",x),z(g,x)}catch(s){console.error("クイズ結果情報の取得に失敗しました",s)}}function z(s,t){const a=c.value.getContext("2d");l&&l.destroy();const m=t.length,g=Math.max(10,Math.max(...t)),x=Math.max(0,g-(10-m));l=new E(a,{type:"bar",data:{labels:s,datasets:[{label:"正答率 (%)",data:t,backgroundColor:"rgba(75, 192, 192, 0.2)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1}]},options:{indexAxis:"y",scales:{x:{beginAtZero:!0,max:Math.ceil(Math.max(...t))},y:{ticks:{suggestedMax:g,suggestedMin:x,font:{size:14}}}}}})}let l=null;return(s,t)=>(p(),_(k,null,[y(D(N),{title:"ランキング"}),y(H,null,{header:C(()=>[J]),default:C(()=>[e("div",K,[y(G)]),e("div",Q,[e("div",X,[e("div",Y,[ee,h(e("input",{type:"date",id:"fromDate","onUpdate:modelValue":t[0]||(t[0]=a=>n.value=a),class:"border rounded-md p-1"},null,512),[[S,n.value]]),te,h(e("input",{type:"date",id:"toDate","onUpdate:modelValue":t[1]||(t[1]=a=>i.value=a),class:"border rounded-md p-1"},null,512),[[S,i.value]]),e("button",{onClick:v,class:"bg-blue-500 text-white rounded-md px-3 py-1 hover:bg-blue-600"}," 検索 "),D(b)?(p(),_("p",ae,M(D(b)),1)):P("",!0)]),e("div",oe,[se,h(e("select",{id:"categorySelect","onUpdate:modelValue":t[2]||(t[2]=a=>r.value=a),onChange:v,class:"border rounded-md p-1"},[ne,(p(!0),_(k,null,B(f.value,a=>(p(),_("option",{key:a.id,value:a.id},M(a.name),9,le))),128))],544),[[R,r.value]])])]),e("div",re,[e("canvas",{ref_key:"rankingChart",ref:c,class:"rounded-md border"},null,512)])])]),_:1})],64))}};export{pe as default};
