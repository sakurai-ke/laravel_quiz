import{k as d,m as V,p as b,o as p,f as v,a as C,u as _,w as k,F as M,b as o,i as D,x as S,t as T,g as z,q as F,s as H}from"./app-54b52079.js";import{_ as R}from"./AuthenticatedLayout-476e5d2a.js";import{Z as B}from"./index.esm-385d90a6.js";import{C as E}from"./auto-5842a5d9.js";import"./ApplicationLogo-6fe9fef8.js";import"./_plugin-vue_export-helper-c27b6911.js";const N=o("h2",{class:"font-semibold text-2xl text-gray-800 leading-tight"},"ランキング",-1),j={class:"p-6"},A={class:"space-y-2"},L={class:"flex space-x-2 items-center"},Z=o("label",{for:"fromDate",class:"text-gray-600"},"From:",-1),q=o("label",{for:"toDate",class:"text-gray-600"},"To:",-1),W={key:0,class:"text-red-500"},G={class:"flex space-x-2 items-center"},J=o("label",{for:"categorySelect",class:"text-gray-600"},"カテゴリー:",-1),K=o("option",{value:"all"},"全て",-1),Q=["value"],X={class:"mt-6",style:{"max-width":"1500px","max-height":"1200px"}},re={__name:"Rank",setup(Y){const x=d(null),m=d("all"),y=d([]),r=d(null),l=d(null);window.addEventListener("resize",()=>{n&&w()});function w(){x.value.getContext("2d"),n.resize();const s=n.data.labels.length,e=Math.max(10,Math.max(...n.data.datasets[0].data)),t=Math.max(0,e-(10-s));n.options.scales.y.ticks.suggestedMax=e,n.options.scales.y.ticks.suggestedMin=t,n.update()}let g=d("");V(()=>{O(),h()});async function O(){try{const s=await b.get("/api/categories");y.value=s.data}catch(s){console.error("カテゴリー情報の取得に失敗しました",s)}}function I(){if(g.value="",r.value&&l.value){const s=new Date(r.value),e=new Date(l.value);if(s>e)return g.value="Fromの日付はTo以前の日付を選択してください。",!1}return!0}async function h(){if(I())try{const s=m.value==="all"?"":`&category=${m.value}`;let e="";if(r.value&&l.value){const a=new Date(r.value),i=new Date(l.value);a.setUTCHours(0,0,0,0),i.setUTCHours(0,0,0,0),console.log("fromDateTime: ",a),console.log("toDateTime: ",i);const U=a.toISOString(),P=i.toISOString();e=`fromDate=${U}&toDate=${P}`,console.log("dateParamsfromto: ",e)}else if(r.value){const a=new Date(r.value);a.setUTCHours(0,0,0,0),e=`fromDate=${a.toISOString()}`,console.log("dateParamsfrom: ",e)}else if(l.value){const a=new Date(l.value);a.setUTCHours(0,0,0,0),e=`toDate=${a.toISOString()}`,console.log("dateParamsto: ",e)}const t=await b.get(`/api/ranking?${e}${s}`),c=t.data;c.sort((a,i)=>i.accuracy-a.accuracy);const u=c.map(a=>a.user.name),f=c.map(a=>a.accuracy);console.log("response: ",t),console.log("rankingData: ",c),console.log("labels: ",u),console.log("dataValues: ",f),$(u,f)}catch(s){console.error("クイズ結果情報の取得に失敗しました",s)}}function $(s,e){const t=x.value.getContext("2d");n&&n.destroy();const c=e.length,u=Math.max(10,Math.max(...e)),f=Math.max(0,u-(10-c));n=new E(t,{type:"bar",data:{labels:s,datasets:[{label:"正答率 (%)",data:e,backgroundColor:"rgba(75, 192, 192, 0.2)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1}]},options:{indexAxis:"y",scales:{x:{beginAtZero:!0,max:Math.ceil(Math.max(...e))},y:{ticks:{suggestedMax:u,suggestedMin:f,font:{size:14}}}}}})}let n=null;return(s,e)=>(p(),v(M,null,[C(_(B),{title:"ランキング"}),C(R,null,{header:k(()=>[N]),default:k(()=>[o("div",j,[o("div",A,[o("div",L,[Z,D(o("input",{type:"date",id:"fromDate","onUpdate:modelValue":e[0]||(e[0]=t=>r.value=t),class:"border rounded-md p-1"},null,512),[[S,r.value]]),q,D(o("input",{type:"date",id:"toDate","onUpdate:modelValue":e[1]||(e[1]=t=>l.value=t),class:"border rounded-md p-1"},null,512),[[S,l.value]]),o("button",{onClick:h,class:"bg-blue-500 text-white rounded-md px-3 py-1 hover:bg-blue-600"}," 検索 "),_(g)?(p(),v("p",W,T(_(g)),1)):z("",!0)]),o("div",G,[J,D(o("select",{id:"categorySelect","onUpdate:modelValue":e[2]||(e[2]=t=>m.value=t),onChange:h,class:"border rounded-md p-1"},[K,(p(!0),v(M,null,H(y.value,t=>(p(),v("option",{key:t.id,value:t.id},T(t.name),9,Q))),128))],544),[[F,m.value]])])]),o("div",X,[o("canvas",{ref_key:"rankingChart",ref:x,class:"rounded-md border"},null,512)])])]),_:1})],64))}};export{re as default};
