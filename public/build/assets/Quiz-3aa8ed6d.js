import{k as u,o as r,f as i,i as T,l as Z,b as t,F as q,j as ee,m as te,p as D,a as se,t as d,u as h,s as P,g as f,n as k,c as oe,w as ae,B as le,C as ne,d as ue,y as re,z as ce}from"./app-219f245d.js";import{i as ie}from"./index.esm-6aa3b88f.js";import{_ as de}from"./_plugin-vue_export-helper-c27b6911.js";const _e={class:"fixed inset-0 flex items-center justify-center z-50","aria-hidden":"true"},be=t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})],-1),pe=[be],he=ee('<header class="modal__header flex justify-between items-center px-4 py-2 bg-gray-100 rounded-t-lg mt-4"><h2 class="modal__title text-lg font-semibold text-gray-800"><span class="font-bold text-blue-700">クイズ画面ヘルプ</span><br></h2></header><main class="modal__content p-4 text-gray-700"><p class="mb-4"><span class="font-bold text-blue-700">問題の表示:</span><br> 画面上部に問題文が表示されます。問題文をよく読み、正しい答えを選んでください。 </p><p class="mb-4"><span class="font-bold text-blue-700">選択肢の選択:</span><br> 問題文の下には選択肢が表示されます。正しい選択肢を選んでください。クイズには1つの正解があります。 </p><p class="mb-4"><span class="font-bold text-blue-700">ヒントボタン:</span><br> 「ヒント」ボタンをクリックすると、ChatGPTのAPIからヒントを取得します。このヒントは、問題文と正解の情報 からChatGPTによって生成されます。 </p><p class="mb-4"><span class="font-bold text-blue-700">回答ボタン:</span><br> 選択肢を選んだら、「回答」ボタンをクリックして回答を提出してください。正解か不正解かが表示されます。 </p><p class="mb-4"><span class="font-bold text-blue-700">クイズ番号のリスト:</span><br> 画面上側にはクイズ番号のリストが表示されます。クイズを飛び越えて選択することができます。 </p><p class="mb-4"><span class="font-bold text-blue-700">前のクイズへ / 次のクイズへ:</span><br> 「前のクイズへ」ボタンと「次のクイズへ」ボタンを使用して、前後の問題に移動できます。 </p><p class="mb-4"><span class="font-bold text-blue-700">結果を見る:</span><br> すべてのクイズに回答した後、結果（クイズの正解率）を確認するためのボタンが表示されます。 </p></main>',2),fe={__name:"QuizModal",setup(g){const b=u(!1),n=()=>{b.value=!b.value},z=c=>{c.target.classList.contains("modal__overlay")&&n()};return(c,s)=>(r(),i(q,null,[T(t("div",_e,[t("div",{class:"modal fixed inset-0 flex items-center justify-center z-50"},[t("div",{onClick:z,class:"modal__overlay fixed inset-0 bg-opacity-50 bg-black"}),t("div",{class:"modal__container bg-white rounded-lg shadow-lg max-w-md mx-auto p-4 z-50 relative",role:"dialog","aria-modal":"true","aria-labelledby":"modal-1-title"},[t("button",{onClick:n,type:"button",class:"modal__close absolute top-4 right-4 focus:outline-none text-gray-500 hover:text-gray-700"},pe),he,t("footer",{class:"modal__footer px-4 py-2"},[t("button",{onClick:n,type:"button",class:"modal__btn modal__btn-primary bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded focus:outline-none mr-2"}," 閉じる ")])])])],512),[[Z,b.value]]),t("button",{onClick:n,type:"button",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded focus:outline-none"},"ヘルプ")],64))}};const V=g=>(re("data-v-ef8c39ab"),g=g(),ce(),g),ve={class:"absolute top-40 right-4 z-50"},ge={class:"text-blue-500 font-semibold"},me={class:"text-blue-500 font-semibold"},we={class:"text-blue-500 font-semibold"},xe={class:"text-blue-500 font-semibold"},ye={class:"text-blue-500 font-semibold"},ke={class:"text-blue-500 font-semibold"},ze={class:"w-full max-w-4xl mx-auto p-6 bg-white rounded-md shadow-md h-auto"},Ce={class:"quiz-progress flex justify-center items-center flex-wrap mb-4"},Qe=["onClick"],$e={class:"mb-2 text-gray-600"},Be={class:"text-xl font-semibold mb-4"},Ie=["src"],Ne={class:"choice-list grid grid-cols-2 gap-4"},De={class:"choice-label block"},qe=["disabled","value"],je=["onClick"],Me=["disabled"],Se={key:2,class:"quiz-end-message mt-4"},Le={key:0,class:"font-semibold text-green-500"},Re={key:1},Pe=V(()=>t("div",{class:"mb-4"},null,-1)),Te={class:"button-group flex justify-between items-center mt-4"},Ve={key:3,class:"mt-4 p-4 bg-gray-100 rounded-md"},Ae=V(()=>t("h3",{class:"text-lg font-semibold mb-2"},"ヒント",-1)),Ee={class:"text-gray-700"},Oe={__name:"Quiz",props:{quizData:Object,selectedNumQuestions:Number,selectedCategory:Number},setup(g){const b=g;console.log("selectedNumQuestionsの値:",b.selectedNumQuestions),console.log("record_idの値:",b.record_id),console.log("selectedCategoryの値:",b.selectedCategory);const n=u(null),z=u([]),c=u("");let s=0,o=[];const p=u(b.quizData),A=u(b.selectedCategory);u(b.selectedNumQuestions);const m=u(!0),j=[],C=u(0);u(null);const Q=u(0),x=u(!0),y=u(!1),w=u(!1);u(!1);const M=[];te(()=>{L()}),o.forEach(e=>{e.user_answer="",e.answered=!1});function E(e){for(let a=e.length-1;a>0;a--){const _=Math.floor(Math.random()*(a+1));[e[a],e[_]]=[e[_],e[a]]}return console.log("choices",e),e}function $(){const e=o[s];console.log("newQuizData",e),p.value=e,z.value=e.choices,n.value=e.user_choice,v.value=null}async function L(){try{const a=(await D.get("/api/quizzes",{params:{category_id:p.value.category_id,num_questions:b.selectedNumQuestions}})).data;if(a.length>0){const _=o.map(l=>l.id);o=a.filter(l=>!_.includes(l.id)).map(l=>({...l,isCorrect:n.value===l.correct_answer,user_choice:"",choices:E([l.correct_answer,l.wrong_answer_1,l.wrong_answer_2,l.wrong_answer_3])})),console.log("shuffledQuizList",o),o[s].answered&&(n.value=o[s].user_answer),$(),m.value=!0,c.value="",B()}else console.error("次のクイズデータがありません")}catch(e){console.error("クイズの取得に失敗しました",e)}}const O=u(!0);async function F(){const e=o[s],a=n.value===e.correct_answer,_={quizIndex:s,isCorrect:a,explanation:e.explain};if(M.push(_),a?(c.value=`正解！
${e.explain}`,e.user_answer=n.value,e.answered=!0,j.push(e),C.value=j.length/o.length*100):(c.value=`不正解！正解は「${e.correct_answer}」です。
${e.explain}`,e.user_answer=n.value,e.answered=!0),await le(),m.value=!1,Q.value++,Q.value===o.length)try{if(O.value){const l={category_id:A.value,total_questions:o.length,correct_answers:j.length,accuracy:C.value,created_at:new Date,updated_at:new Date},X=(await D.post("/api/record",l)).data.data.id;for(const N of o){const Y={record_id:X,quiz_id:N.id,selected_choice:N.user_answer,correct:N.user_answer===N.correct_answer,created_at:new Date,updated_at:new Date};await D.post("/api/result",Y)}w.value=!0,console.log("showResultButton.",w.value)}}catch(l){console.error("結果の保存に失敗しました",l)}}async function R(){c.value="",n.value="",s<o.length-1?(s++,$(),o[s].answered?m.value=!1:m.value=!0,B()):L(),console.log("showResultButton.",w.value)}function G(){if(c.value="",n.value="",o[s].answered){const e=M.find(a=>a.quizIndex===s);e&&(c.value=e.isCorrect?`正解！
${e.explanation}`:`不正解！正解は「${o[s].correct_answer}」です。
${e.explanation}`)}s>0&&(s--,$(),B()),console.log("showResultButton.",w.value)}function B(){if(s===0?(y.value=!1,x.value=!0):s===o.length-1?(y.value=!0,x.value=!1):(y.value=!0,x.value=!0),o[s].answered){const e=M.find(a=>a.quizIndex===s);e&&(c.value=e.isCorrect?`正解！
${e.explanation}`:`不正解！正解は「${o[s].correct_answer}」です。
${e.explanation}`)}}function U(e){o[s].answered||(n.value=e,S.value=e,o[s].user_choice=e)}function W(e){return"/storage/images/"+e}const S=u(null);function H(){c.value=""}function J(e){s=e,H(),o[s].answered?S.value=o[s].user_choice:S.value=null,$(),m.value=!0,B()}const v=u("");async function K(){v.value=null;try{const e=await D.post("/api/get-hint",{problem_statement:p.value.title,correct_answer:p.value.correct_answer});console.log("responseの値:",e);const a=e.data.hint;a?(v.value=a,console.log("ヒントの値:",v.value)):v.value="このクイズにはヒントがありません。"}catch(e){console.error("ヒントの取得に失敗しました",e)}}return(e,a)=>(r(),i(q,null,[t("div",ve,[se(fe)]),t("p",ge,"正答率"+d(C.value),1),t("p",me,"何問目か"+d(h(s)+1),1),t("p",we,"回答済みはいくつあるか"+d(Q.value),1),t("p",xe,"showresultbutton"+d(w.value),1),t("p",ye,"answeredQuestions"+d(Q.value),1),t("p",ke,"shuffledQuizList.length"+d(h(o).length),1),t("div",ze,[t("div",Ce,[(r(!0),i(q,null,P(h(o),(_,l)=>(r(),i("div",{key:l,class:k(["quiz-number",_.answered?"bg-green-500 text-white":"bg-white border",l===h(s)?"current-quiz":""]),onClick:I=>J(l)},d(l+1),11,Qe))),128))]),t("p",$e,d(h(s)+1)+"問目 / "+d(h(o).length)+"問中 ",1),t("h2",Be,d(p.value.title),1),p.value.image_src?(r(),i("img",{key:0,src:W(p.value.image_src),alt:"Quiz Image",class:"mb-4 mx-auto"},null,8,Ie)):f("",!0),t("ul",Ne,[(r(!0),i(q,null,P(z.value,(_,l)=>(r(),i("li",{key:l},[t("label",De,[T(t("input",{type:"radio",disabled:p.value.answered,"onUpdate:modelValue":a[0]||(a[0]=I=>n.value=I),value:_,class:"hidden"},null,8,qe),[[ne,n.value]]),t("button",{class:k(["choice-button w-full py-2 px-4 rounded-md focus:outline-none transition duration-300",n.value===_?"bg-blue-500 text-white":"bg-gray-300 cursor-not-allowed"]),onClick:I=>U(_)},d(_),11,je)])]))),128))]),m.value&&!p.value.answered?(r(),i("button",{key:1,onClick:F,class:k(["answer-button mt-4 w-full py-2 px-4 rounded-md focus:outline-none transition duration-300",n.value!==""?"bg-blue-500 hover:bg-blue-600 text-white":"bg-gray-300 cursor-not-allowed"]),disabled:n.value===""}," 回答 ",10,Me)):f("",!0),c.value!==""?(r(),i("div",Se,[c.value.startsWith("正解")?(r(),i("p",Le,d(c.value),1)):(r(),i("p",Re,d(c.value),1)),Pe,h(s)<h(o).length-1?(r(),i("button",{key:2,onClick:R,class:"block mx-auto mt-8 w-full max-w-xs py-2 px-4 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none transition duration-300"}," 次へ ")):f("",!0),w.value?(r(),oe(h(ie),{key:3,href:e.route("quiz.result",{correctPercentage:C.value}),class:"block mx-auto mt-8 w-28 py-2 px-4 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none transition duration-300"},{default:ae(()=>[ue(" 結果を見る ")]),_:1},8,["href"])):f("",!0)])):f("",!0),t("div",Te,[y.value?(r(),i("button",{key:0,onClick:G,class:k(["prev-button",y.value?"bg-blue-500 hover:bg-blue-600 text-white":"bg-gray-300 cursor-not-allowed"])}," 前のクイズへ ",2)):f("",!0),x.value?(r(),i("button",{key:1,onClick:R,class:k(["next-button",x.value?"bg-blue-500 hover:bg-blue-600 text-white":"bg-gray-300 cursor-not-allowed"])}," 次のクイズへ ",2)):f("",!0)]),t("button",{onClick:K,class:"mt-4 py-2 px-4 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none transition duration-300"}," ヒント "),v.value?(r(),i("div",Ve,[Ae,t("p",Ee,d(v.value),1)])):f("",!0)])],64))}},We=de(Oe,[["__scopeId","data-v-ef8c39ab"]]);export{We as default};
